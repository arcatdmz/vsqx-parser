function e(e){return{vbs:parseInt(e.querySelector("vVoice>vBS").textContent),vpc:parseInt(e.querySelector("vVoice>vPC").textContent),name:e.querySelector("vVoice>vVoiceName").textContent}}function t(e){return{tick:parseInt(e.querySelector("tempo>posTick").textContent),bpm:parseInt(e.querySelector("tempo>bpm").textContent)}}function r(e,t){return Array.prototype.slice.call(e.querySelectorAll("vsq3>vsTrack")).map(function(e){return function(e,t){var r=parseInt(e.querySelector("vsTrack>vsTrackNo").textContent),o=e.querySelector("vsTrack>trackName").textContent,c=e.querySelector("vsTrack>comment").textContent,a=function(e,t){var r=parseInt(e.querySelector("musicalPart>posTick").textContent),o=parseInt(e.querySelector("musicalPart>playTime").textContent),c=parseInt(e.querySelector("musicalPart>singer>vBS").textContent),a=parseInt(e.querySelector("musicalPart>singer>vPC").textContent),l=function(e,t,r){return e.find(function(e){return e.vbs===t&&e.vpc===r})}(t,c,a),s=e.querySelector("musicalPart>comment").textContent,u=Array.prototype.slice.call(e.querySelectorAll("musicalPart>note")).map(n);return{tick:r,playTime:o,singer:l,comment:s,notes:u}}(e.querySelector("vsTrack>musicalPart"),t);return{no:r,name:o,comment:c,content:a}}(e,t)})}function n(e){var t=["posTick","durTick","noteNum","velocity"].map(function(t){return parseInt(e.querySelector("note>"+t).textContent)}),r=t[0],n=t[1],o=t[2],c=t[3],a=["lyric","phnms"].map(function(t){return e.querySelector("note>"+t).textContent});return{tick:r,duration:n,note:o,velocity:c,lyric:a[0],phonemes:a[1]}}var o="http://www.yamaha.co.jp/vocaloid/schema/vsq3/",c="http://www.yamaha.co.jp/vocaloid/schema/vsq4/";function a(n){var a=(new DOMParser).parseFromString(n,"text/xml");if(function(e){var t=(new DOMParser).parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;if("http://www.w3.org/1999/xhtml"===t)return e.getElementsByTagName("parsererror").length>0;return e.getElementsByTagNameNS(t,"parsererror").length>0}(a))return{error:"XML parse error",data:null};if(a.children.length<=0||a.children[0].namespaceURI!==o&&a.children[0].namespaceURI!==c||"vsq3"!==a.children[0].tagName&&"vsq4"!==a.children[0].tagName)return{error:"Unsupported VSQX format",data:null};var l,s=a.children[0],u=s.querySelector("vsq3>vender")||s.querySelector("vsq4>vender"),i=u&&u.textContent,p=s.querySelector("vsq3>version")||s.querySelector("vsq4>version"),m=p&&p.textContent,v="vsq3"===a.children[0].tagName,y=v?(l=s,Array.prototype.slice.call(l.querySelectorAll("vsq3>masterTrack>tempo")).map(t)):function(e){return Array.prototype.slice.call(e.querySelectorAll("vsq4>masterTrack>tempo")).map(function(e){return{tick:parseInt(e.querySelector("t").textContent),bpm:parseInt(e.querySelector("v").textContent)}})}(s),q=v?function(t){return Array.prototype.slice.call(t.querySelectorAll("vsq3>vVoiceTable>vVoice")).map(e)}(s):null;return{data:{vender:i,version:m,voices:q,tempos:y,tracks:v?r(s,q):null,raw:s}}}function l(e,t,r){return e.find(function(e){return e.vbs===t&&e.vpc===r})}export{l as findVoice,a as parse};
