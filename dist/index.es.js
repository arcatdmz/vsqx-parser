function e(e,t,r){return e.find(function(e){return e.vbs===t&&e.vpc===r})}function t(e){return{vbs:parseInt(e.querySelector("vVoice>vBS").textContent),vpc:parseInt(e.querySelector("vVoice>vPC").textContent),name:e.querySelector("vVoice>vVoiceName").textContent}}function r(e){return{tick:parseInt(e.querySelector("tempo>posTick").textContent),bpm:parseInt(e.querySelector("tempo>bpm").textContent)}}function n(t,r){return Array.prototype.slice.call(t.querySelectorAll("vsq3>vsTrack")).map(function(t){return function(t,r){var n=parseInt(t.querySelector("vsTrack>vsTrackNo").textContent),c=t.querySelector("vsTrack>trackName").textContent,a=t.querySelector("vsTrack>comment").textContent,l=function(t,r){var n=parseInt(t.querySelector("musicalPart>posTick").textContent),c=parseInt(t.querySelector("musicalPart>playTime").textContent),a=parseInt(t.querySelector("musicalPart>singer>vBS").textContent),l=parseInt(t.querySelector("musicalPart>singer>vPC").textContent),s=e(r,a,l),u=t.querySelector("musicalPart>comment").textContent,i=Array.prototype.slice.call(t.querySelectorAll("musicalPart>note")).map(o);return{tick:n,playTime:c,singer:s,comment:u,notes:i}}(t.querySelector("vsTrack>musicalPart"),r);return{no:n,name:c,comment:a,content:l}}(t,r)})}function o(e){var t=["posTick","durTick","noteNum","velocity"].map(function(t){return parseInt(e.querySelector("note>"+t).textContent)}),r=t[0],n=t[1],o=t[2],c=t[3],a=["lyric","phnms"].map(function(t){return e.querySelector("note>"+t).textContent});return{tick:r,duration:n,note:o,velocity:c,lyric:a[0],phonemes:a[1]}}function c(e){return{vbs:parseInt(e.querySelector("vVoice>bs").textContent),vpc:parseInt(e.querySelector("vVoice>pc").textContent),name:e.querySelector("vVoice>name").textContent}}function a(e){return{tick:parseInt(e.querySelector("t").textContent),bpm:parseInt(e.querySelector("v").textContent)}}function l(t,r){return Array.prototype.slice.call(t.querySelectorAll("vsq4>vsTrack")).map(function(t){return function(t,r){var n=parseInt(t.querySelector("vsTrack>tNo").textContent),o=t.querySelector("vsTrack>name").textContent,c=t.querySelector("vsTrack>comment").textContent,a=function(t,r){var n=parseInt(t.querySelector("vsPart>t").textContent),o=parseInt(t.querySelector("vsPart>playTime").textContent),c=parseInt(t.querySelector("vsPart>singer>bs").textContent),a=parseInt(t.querySelector("vsPart>singer>pc").textContent),l=e(r,c,a),u=t.querySelector("vsPart>comment").textContent,i=Array.prototype.slice.call(t.querySelectorAll("vsPart>note")).map(s);return{tick:n,playTime:o,singer:l,comment:u,notes:i}}(t.querySelector("vsTrack>vsPart"),r);return{no:n,name:o,comment:c,content:a}}(t,r)})}function s(e){var t=["t","dur","n","v"].map(function(t){return parseInt(e.querySelector("note>"+t).textContent)}),r=t[0],n=t[1],o=t[2],c=t[3],a=["y","p"].map(function(t){return e.querySelector("note>"+t).textContent});return{tick:r,duration:n,note:o,velocity:c,lyric:a[0],phonemes:a[1]}}var u="http://www.yamaha.co.jp/vocaloid/schema/vsq3/",i="http://www.yamaha.co.jp/vocaloid/schema/vsq4/";function p(e){var o=(new DOMParser).parseFromString(e,"text/xml");if(function(e){var t=(new DOMParser).parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;if("http://www.w3.org/1999/xhtml"===t)return e.getElementsByTagName("parsererror").length>0;return e.getElementsByTagNameNS(t,"parsererror").length>0}(o))return{error:"XML parse error",data:null};if(o.children.length<=0||o.children[0].namespaceURI!==u&&o.children[0].namespaceURI!==i||"vsq3"!==o.children[0].tagName&&"vsq4"!==o.children[0].tagName)return{error:"Unsupported VSQX format",data:null};var s,p=o.children[0],m=p.querySelector("vsq3>vender")||p.querySelector("vsq4>vender"),v=m&&m.textContent,y=p.querySelector("vsq3>version")||p.querySelector("vsq4>version"),q=y&&y.textContent,S="vsq3"===o.children[0].tagName,x=S?(s=p,Array.prototype.slice.call(s.querySelectorAll("vsq3>masterTrack>tempo")).map(r)):function(e){return Array.prototype.slice.call(e.querySelectorAll("vsq4>masterTrack>tempo")).map(a)}(p),C=S?function(e){return Array.prototype.slice.call(e.querySelectorAll("vsq3>vVoiceTable>vVoice")).map(t)}(p):function(e){return Array.prototype.slice.call(e.querySelectorAll("vsq4>vVoiceTable>vVoice")).map(c)}(p);return{data:{vender:v,version:q,voices:C,tempos:x,tracks:S?n(p,C):l(p,C),raw:p}}}export{p as parse};
