"use strict";function findVoice(e,r,t){return e.find(function(e){return e.vbs===r&&e.vpc===t})}function parseVSQ3Voices(e){return Array.prototype.slice.call(e.querySelectorAll("vsq3>vVoiceTable>vVoice")).map(parseVoice)}function parseVoice(e){return{vbs:parseInt(e.querySelector("vVoice>vBS").textContent),vpc:parseInt(e.querySelector("vVoice>vPC").textContent),name:e.querySelector("vVoice>vVoiceName").textContent}}function parseVSQ3Tempos(e){return Array.prototype.slice.call(e.querySelectorAll("vsq3>masterTrack>tempo")).map(parseTempo)}function parseTempo(e){return{tick:parseInt(e.querySelector("tempo>posTick").textContent),bpm:parseInt(e.querySelector("tempo>bpm").textContent)}}function parseVSQ3Tracks(e,r){return Array.prototype.slice.call(e.querySelectorAll("vsq3>vsTrack")).map(function(e){return parseTrack(e,r)})}function parseTrack(e,r){return{no:parseInt(e.querySelector("vsTrack>vsTrackNo").textContent),name:e.querySelector("vsTrack>trackName").textContent,comment:e.querySelector("vsTrack>comment").textContent,content:parseMusicalPart(e.querySelector("vsTrack>musicalPart"),r)}}function parseMusicalPart(e,r){return{tick:parseInt(e.querySelector("musicalPart>posTick").textContent),playTime:parseInt(e.querySelector("musicalPart>playTime").textContent),singer:findVoice(r,parseInt(e.querySelector("musicalPart>singer>vBS").textContent),parseInt(e.querySelector("musicalPart>singer>vPC").textContent)),comment:e.querySelector("musicalPart>comment").textContent,notes:Array.prototype.slice.call(e.querySelectorAll("musicalPart>note")).map(parseNote)}}function parseNote(e){var r=["posTick","durTick","noteNum","velocity"].map(function(r){return parseInt(e.querySelector("note>"+r).textContent)}),t=r[0],n=r[1],o=r[2],a=r[3],c=["lyric","phnms"].map(function(r){return e.querySelector("note>"+r).textContent});return{tick:t,duration:n,note:o,velocity:a,lyric:c[0],phonemes:c[1]}}function parseVSQ4Tempos(e){return Array.prototype.slice.call(e.querySelectorAll("vsq4>masterTrack>tempo")).map(function(e){return{tick:parseInt(e.querySelector("t").textContent),bpm:parseInt(e.querySelector("v").textContent)}})}Object.defineProperty(exports,"__esModule",{value:!0});var vsq3NS="http://www.yamaha.co.jp/vocaloid/schema/vsq3/",vsq4NS="http://www.yamaha.co.jp/vocaloid/schema/vsq4/";function parse(e){var r=(new DOMParser).parseFromString(e,"text/xml");if(isParseError(r))return{error:"XML parse error",data:null};if(r.children.length<=0||r.children[0].namespaceURI!==vsq3NS&&r.children[0].namespaceURI!==vsq4NS||"vsq3"!==r.children[0].tagName&&"vsq4"!==r.children[0].tagName)return{error:"Unsupported VSQX format",data:null};var t=r.children[0],n=t.querySelector("vsq3>vender")||t.querySelector("vsq4>vender"),o=n&&n.textContent,a=t.querySelector("vsq3>version")||t.querySelector("vsq4>version"),c=a&&a.textContent,s="vsq3"===r.children[0].tagName,l=s?parseVSQ3Tempos(t):parseVSQ4Tempos(t),p=s?parseVSQ3Voices(t):null;return{data:{vender:o,version:c,voices:p,tempos:l,tracks:s?parseVSQ3Tracks(t,p):null,raw:t}}}function isParseError(e){var r=(new DOMParser).parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;return"http://www.w3.org/1999/xhtml"===r?e.getElementsByTagName("parsererror").length>0:e.getElementsByTagNameNS(r,"parsererror").length>0}exports.parse=parse;
