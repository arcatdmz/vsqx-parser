{"version":3,"sources":["../dist/index.es.js","index.ts"],"names":["e","vbs","parseInt","querySelector","textContent","vpc","name","t","tick","bpm","r","Array","prototype","slice","call","querySelectorAll","map","no","comment","content","playTime","singer","find","notes","n","o","c","a","duration","note","velocity","lyric","phonemes","DOMParser","parseFromString","getElementsByTagName","namespaceURI","length","getElementsByTagNameNS","error","data","children","tagName","l","s","u","i","p","m","v","y","q","vender","version","voices","tempos","tracks","raw"],"mappings":"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","file":"example.81c70a5a.js","sourceRoot":"..\\example","sourcesContent":["function e(e){return{vbs:parseInt(e.querySelector(\"vVoice>vBS\").textContent),vpc:parseInt(e.querySelector(\"vVoice>vPC\").textContent),name:e.querySelector(\"vVoice>vVoiceName\").textContent}}function t(e){return{tick:parseInt(e.querySelector(\"tempo>posTick\").textContent),bpm:parseInt(e.querySelector(\"tempo>bpm\").textContent)}}function r(e,t){return Array.prototype.slice.call(e.querySelectorAll(\"vsq3>vsTrack\")).map(function(e){return function(e,t){var r=parseInt(e.querySelector(\"vsTrack>vsTrackNo\").textContent),o=e.querySelector(\"vsTrack>trackName\").textContent,c=e.querySelector(\"vsTrack>comment\").textContent,a=function(e,t){var r=parseInt(e.querySelector(\"musicalPart>posTick\").textContent),o=parseInt(e.querySelector(\"musicalPart>playTime\").textContent),c=parseInt(e.querySelector(\"musicalPart>singer>vBS\").textContent),a=parseInt(e.querySelector(\"musicalPart>singer>vPC\").textContent),l=function(e,t,r){return e.find(function(e){return e.vbs===t&&e.vpc===r})}(t,c,a),s=e.querySelector(\"musicalPart>comment\").textContent,u=Array.prototype.slice.call(e.querySelectorAll(\"musicalPart>note\")).map(n);return{tick:r,playTime:o,singer:l,comment:s,notes:u}}(e.querySelector(\"vsTrack>musicalPart\"),t);return{no:r,name:o,comment:c,content:a}}(e,t)})}function n(e){var t=[\"posTick\",\"durTick\",\"noteNum\",\"velocity\"].map(function(t){return parseInt(e.querySelector(\"note>\"+t).textContent)}),r=t[0],n=t[1],o=t[2],c=t[3],a=[\"lyric\",\"phnms\"].map(function(t){return e.querySelector(\"note>\"+t).textContent});return{tick:r,duration:n,note:o,velocity:c,lyric:a[0],phonemes:a[1]}}var o=\"http://www.yamaha.co.jp/vocaloid/schema/vsq3/\",c=\"http://www.yamaha.co.jp/vocaloid/schema/vsq4/\";function a(n){var a=(new DOMParser).parseFromString(n,\"text/xml\");if(function(e){var t=(new DOMParser).parseFromString(\"<\",\"text/xml\").getElementsByTagName(\"parsererror\")[0].namespaceURI;if(\"http://www.w3.org/1999/xhtml\"===t)return e.getElementsByTagName(\"parsererror\").length>0;return e.getElementsByTagNameNS(t,\"parsererror\").length>0}(a))return{error:\"XML parse error\",data:null};if(a.children.length<=0||a.children[0].namespaceURI!==o&&a.children[0].namespaceURI!==c||\"vsq3\"!==a.children[0].tagName&&\"vsq4\"!==a.children[0].tagName)return{error:\"Unsupported VSQX format\",data:null};var l,s=a.children[0],u=s.querySelector(\"vsq3>vender\")||s.querySelector(\"vsq4>vender\"),i=u&&u.textContent,p=s.querySelector(\"vsq3>version\")||s.querySelector(\"vsq4>version\"),m=p&&p.textContent,v=\"vsq3\"===a.children[0].tagName,y=v?(l=s,Array.prototype.slice.call(l.querySelectorAll(\"vsq3>masterTrack>tempo\")).map(t)):function(e){return Array.prototype.slice.call(e.querySelectorAll(\"vsq4>masterTrack>tempo\")).map(function(e){return{tick:parseInt(e.querySelector(\"t\").textContent),bpm:parseInt(e.querySelector(\"v\").textContent)}})}(s),q=v?function(t){return Array.prototype.slice.call(t.querySelectorAll(\"vsq3>vVoiceTable>vVoice\")).map(e)}(s):null;return{data:{vender:i,version:m,voices:q,tempos:y,tracks:v?r(s,q):null,raw:s}}}function l(e,t,r){return e.find(function(e){return e.vbs===t&&e.vpc===r})}export{l as findVoice,a as parse};\n","import { parse } from \"../\";\r\n\r\nconst input = document.querySelector(\"input\") as HTMLInputElement;\r\ninput.addEventListener(\"change\", handleFileSelect);\r\n\r\nfunction handleFileSelect() {\r\n  if (input.files.length <= 0) return;\r\n  const file = input.files.item(0);\r\n  const reader = new FileReader();\r\n  reader.addEventListener(\"load\", _e => {\r\n    const result = parse(reader.result as string);\r\n    const raw = result.data.raw;\r\n    self[\"vsqx\"] = raw;\r\n    delete result.data.raw;\r\n    document.querySelector(\"pre\").textContent = JSON.stringify(\r\n      result,\r\n      null,\r\n      \"  \"\r\n    );\r\n    if (result.data.tracks) {\r\n      const dl = document.querySelector(\"dl\");\r\n      result.data.tracks.forEach(track => {\r\n        const dt = document.createElement(\"dt\");\r\n        dt.appendChild(document.createTextNode(`${track.no}:${track.name}`));\r\n        const dd = document.createElement(\"dd\");\r\n        dd.appendChild(\r\n          document.createTextNode(\r\n            track.content.notes.map(note => note.lyric).join(\"\")\r\n          )\r\n        );\r\n        dl.appendChild(dt);\r\n        dl.appendChild(dd);\r\n      });\r\n    }\r\n  });\r\n  reader.readAsBinaryString(file);\r\n  // Array.from(input.files).forEach(console.log.bind(console));\r\n}\r\n"]}