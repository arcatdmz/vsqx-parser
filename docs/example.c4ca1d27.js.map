{"version":3,"sources":["../dist/index.es.js","index.ts"],"names":["e","t","r","find","vbs","vpc","parseInt","querySelector","textContent","name","tick","bpm","n","Array","prototype","slice","call","querySelectorAll","map","no","comment","content","playTime","singer","notes","o","c","a","duration","note","velocity","lyric","phonemes","l","s","u","i","p","DOMParser","parseFromString","getElementsByTagName","namespaceURI","length","getElementsByTagNameNS","error","data","children","tagName","m","v","y","q","S","x","C","vender","version","voices","tempos","tracks","raw"],"mappings":"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","file":"example.c4ca1d27.js","sourceRoot":"..\\example","sourcesContent":["function e(e,t,r){return e.find(function(e){return e.vbs===t&&e.vpc===r})}function t(e){return{vbs:parseInt(e.querySelector(\"vVoice>vBS\").textContent),vpc:parseInt(e.querySelector(\"vVoice>vPC\").textContent),name:e.querySelector(\"vVoice>vVoiceName\").textContent}}function r(e){return{tick:parseInt(e.querySelector(\"tempo>posTick\").textContent),bpm:parseInt(e.querySelector(\"tempo>bpm\").textContent)}}function n(t,r){return Array.prototype.slice.call(t.querySelectorAll(\"vsq3>vsTrack\")).map(function(t){return function(t,r){var n=parseInt(t.querySelector(\"vsTrack>vsTrackNo\").textContent),c=t.querySelector(\"vsTrack>trackName\").textContent,a=t.querySelector(\"vsTrack>comment\").textContent,l=function(t,r){var n=parseInt(t.querySelector(\"musicalPart>posTick\").textContent),c=parseInt(t.querySelector(\"musicalPart>playTime\").textContent),a=parseInt(t.querySelector(\"musicalPart>singer>vBS\").textContent),l=parseInt(t.querySelector(\"musicalPart>singer>vPC\").textContent),s=e(r,a,l),u=t.querySelector(\"musicalPart>comment\").textContent,i=Array.prototype.slice.call(t.querySelectorAll(\"musicalPart>note\")).map(o);return{tick:n,playTime:c,singer:s,comment:u,notes:i}}(t.querySelector(\"vsTrack>musicalPart\"),r);return{no:n,name:c,comment:a,content:l}}(t,r)})}function o(e){var t=[\"posTick\",\"durTick\",\"noteNum\",\"velocity\"].map(function(t){return parseInt(e.querySelector(\"note>\"+t).textContent)}),r=t[0],n=t[1],o=t[2],c=t[3],a=[\"lyric\",\"phnms\"].map(function(t){return e.querySelector(\"note>\"+t).textContent});return{tick:r,duration:n,note:o,velocity:c,lyric:a[0],phonemes:a[1]}}function c(e){return{vbs:parseInt(e.querySelector(\"vVoice>bs\").textContent),vpc:parseInt(e.querySelector(\"vVoice>pc\").textContent),name:e.querySelector(\"vVoice>name\").textContent}}function a(e){return{tick:parseInt(e.querySelector(\"t\").textContent),bpm:parseInt(e.querySelector(\"v\").textContent)}}function l(t,r){return Array.prototype.slice.call(t.querySelectorAll(\"vsq4>vsTrack\")).map(function(t){return function(t,r){var n=parseInt(t.querySelector(\"vsTrack>tNo\").textContent),o=t.querySelector(\"vsTrack>name\").textContent,c=t.querySelector(\"vsTrack>comment\").textContent,a=function(t,r){var n=parseInt(t.querySelector(\"vsPart>t\").textContent),o=parseInt(t.querySelector(\"vsPart>playTime\").textContent),c=parseInt(t.querySelector(\"vsPart>singer>bs\").textContent),a=parseInt(t.querySelector(\"vsPart>singer>pc\").textContent),l=e(r,c,a),u=t.querySelector(\"vsPart>comment\").textContent,i=Array.prototype.slice.call(t.querySelectorAll(\"vsPart>note\")).map(s);return{tick:n,playTime:o,singer:l,comment:u,notes:i}}(t.querySelector(\"vsTrack>vsPart\"),r);return{no:n,name:o,comment:c,content:a}}(t,r)})}function s(e){var t=[\"t\",\"dur\",\"n\",\"v\"].map(function(t){return parseInt(e.querySelector(\"note>\"+t).textContent)}),r=t[0],n=t[1],o=t[2],c=t[3],a=[\"y\",\"p\"].map(function(t){return e.querySelector(\"note>\"+t).textContent});return{tick:r,duration:n,note:o,velocity:c,lyric:a[0],phonemes:a[1]}}var u=\"http://www.yamaha.co.jp/vocaloid/schema/vsq3/\",i=\"http://www.yamaha.co.jp/vocaloid/schema/vsq4/\";function p(e){var o=(new DOMParser).parseFromString(e,\"text/xml\");if(function(e){var t=(new DOMParser).parseFromString(\"<\",\"text/xml\").getElementsByTagName(\"parsererror\")[0].namespaceURI;if(\"http://www.w3.org/1999/xhtml\"===t)return e.getElementsByTagName(\"parsererror\").length>0;return e.getElementsByTagNameNS(t,\"parsererror\").length>0}(o))return{error:\"XML parse error\",data:null};if(o.children.length<=0||o.children[0].namespaceURI!==u&&o.children[0].namespaceURI!==i||\"vsq3\"!==o.children[0].tagName&&\"vsq4\"!==o.children[0].tagName)return{error:\"Unsupported VSQX format\",data:null};var s,p=o.children[0],m=p.querySelector(\"vsq3>vender\")||p.querySelector(\"vsq4>vender\"),v=m&&m.textContent,y=p.querySelector(\"vsq3>version\")||p.querySelector(\"vsq4>version\"),q=y&&y.textContent,S=\"vsq3\"===o.children[0].tagName,x=S?(s=p,Array.prototype.slice.call(s.querySelectorAll(\"vsq3>masterTrack>tempo\")).map(r)):function(e){return Array.prototype.slice.call(e.querySelectorAll(\"vsq4>masterTrack>tempo\")).map(a)}(p),C=S?function(e){return Array.prototype.slice.call(e.querySelectorAll(\"vsq3>vVoiceTable>vVoice\")).map(t)}(p):function(e){return Array.prototype.slice.call(e.querySelectorAll(\"vsq4>vVoiceTable>vVoice\")).map(c)}(p);return{data:{vender:v,version:q,voices:C,tempos:x,tracks:S?n(p,C):l(p,C),raw:p}}}export{p as parse};\n","import { parse } from \"../\";\r\n\r\nconst input = document.querySelector(\"input\") as HTMLInputElement;\r\ninput.addEventListener(\"change\", handleFileSelect);\r\n\r\nfunction handleFileSelect() {\r\n  if (input.files.length <= 0) return;\r\n  const file = input.files.item(0);\r\n  const reader = new FileReader();\r\n  reader.addEventListener(\"load\", _e => {\r\n    const result = parse(reader.result as string);\r\n    const raw = result.data.raw;\r\n    self[\"vsqx\"] = raw;\r\n    delete result.data.raw;\r\n    document.querySelector(\"pre\").textContent = JSON.stringify(\r\n      result,\r\n      null,\r\n      \"  \"\r\n    );\r\n    if (result.data.tracks) {\r\n      const dl = document.querySelector(\"dl\");\r\n      result.data.tracks.forEach(track => {\r\n        const dt = document.createElement(\"dt\");\r\n        dt.appendChild(document.createTextNode(`${track.no}:${track.name}`));\r\n        const dd = document.createElement(\"dd\");\r\n        dd.appendChild(\r\n          document.createTextNode(\r\n            track.content.notes.map(note => note.lyric).join(\"\")\r\n          )\r\n        );\r\n        dl.appendChild(dt);\r\n        dl.appendChild(dd);\r\n      });\r\n    }\r\n  });\r\n  reader.readAsText(file);\r\n  // Array.from(input.files).forEach(console.log.bind(console));\r\n}\r\n"]}