{"version":3,"sources":["../dist/index.es.js","index.ts"],"names":["e","t","r","find","vbs","vpc","parseInt","querySelector","textContent","name","tick","duration","bpm","n","Array","prototype","slice","call","querySelectorAll","map","no","comment","content","singer","notes","o","a","c","note","velocity","lyric","phonemes","u","i","s","l","m","DOMParser","parseFromString","getElementsByTagName","namespaceURI","length","getElementsByTagNameNS","error","data","children","tagName","p","v","y","q","S","f","k","d","x","g","T","forEach","h","vender","version","resolution","preMeasure","timeSig","nume","denomi","voices","tempos","tracks","raw","result","Object","defineProperty","get","enumerable","configurable","ticksPerMeasure","getOffsetTickForTrack","offsetTick","tickToTime"],"mappings":"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","file":"example.cc0b214d.js","sourceRoot":"..\\example","sourcesContent":["function e(e,t,r){return e.find(function(e){return e.vbs===t&&e.vpc===r})}function t(e){return{vbs:parseInt(e.querySelector(\"vVoice>vBS\").textContent),vpc:parseInt(e.querySelector(\"vVoice>vPC\").textContent),name:e.querySelector(\"vVoice>vVoiceName\").textContent}}function r(e){return{tick:parseInt(e.querySelector(\"tempo>posTick\").textContent),duration:-1,bpm:parseInt(e.querySelector(\"tempo>bpm\").textContent)}}function n(t,r){return Array.prototype.slice.call(t.querySelectorAll(\"vsq3>vsTrack\")).map(function(t){return function(t,r){var n=parseInt(t.querySelector(\"vsTrack>vsTrackNo\").textContent),a=t.querySelector(\"vsTrack>trackName\").textContent,c=t.querySelector(\"vsTrack>comment\").textContent,u=function(t,r){var n=parseInt(t.querySelector(\"musicalPart>posTick\").textContent),a=parseInt(t.querySelector(\"musicalPart>playTime\").textContent),c=parseInt(t.querySelector(\"musicalPart>singer>vBS\").textContent),u=parseInt(t.querySelector(\"musicalPart>singer>vPC\").textContent),i=e(r,c,u),s=t.querySelector(\"musicalPart>comment\").textContent,l=Array.prototype.slice.call(t.querySelectorAll(\"musicalPart>note\")).map(o);return{tick:n,duration:a,singer:i,comment:s,notes:l}}(t.querySelector(\"vsTrack>musicalPart\"),r);return{no:n,name:a,comment:c,content:u}}(t,r)})}function o(e){var t=[\"posTick\",\"durTick\",\"noteNum\",\"velocity\"].map(function(t){return parseInt(e.querySelector(\"note>\"+t).textContent)}),r=t[0],n=t[1],o=t[2],a=t[3],c=[\"lyric\",\"phnms\"].map(function(t){return e.querySelector(\"note>\"+t).textContent});return{tick:r,duration:n,note:o,velocity:a,lyric:c[0],phonemes:c[1]}}function a(e){return{vbs:parseInt(e.querySelector(\"vVoice>bs\").textContent),vpc:parseInt(e.querySelector(\"vVoice>pc\").textContent),name:e.querySelector(\"vVoice>name\").textContent}}function c(e){return{tick:parseInt(e.querySelector(\"t\").textContent),duration:-1,bpm:parseInt(e.querySelector(\"v\").textContent)}}function u(t,r){return Array.prototype.slice.call(t.querySelectorAll(\"vsq4>vsTrack\")).map(function(t){return function(t,r){var n=parseInt(t.querySelector(\"vsTrack>tNo\").textContent),o=t.querySelector(\"vsTrack>name\").textContent,a=t.querySelector(\"vsTrack>comment\").textContent,c=function(t,r){var n=parseInt(t.querySelector(\"vsPart>t\").textContent),o=parseInt(t.querySelector(\"vsPart>playTime\").textContent),a=parseInt(t.querySelector(\"vsPart>singer>bs\").textContent),c=parseInt(t.querySelector(\"vsPart>singer>pc\").textContent),u=e(r,a,c),s=t.querySelector(\"vsPart>comment\").textContent,l=Array.prototype.slice.call(t.querySelectorAll(\"vsPart>note\")).map(i);return{tick:n,duration:o,singer:u,comment:s,notes:l}}(t.querySelector(\"vsTrack>vsPart\"),r);return{no:n,name:o,comment:a,content:c}}(t,r)})}function i(e){var t=[\"t\",\"dur\",\"n\",\"v\"].map(function(t){return parseInt(e.querySelector(\"note>\"+t).textContent)}),r=t[0],n=t[1],o=t[2],a=t[3],c=[\"y\",\"p\"].map(function(t){return e.querySelector(\"note>\"+t).textContent});return{tick:r,duration:n,note:o,velocity:a,lyric:c[0],phonemes:c[1]}}var s=\"http://www.yamaha.co.jp/vocaloid/schema/vsq3/\",l=\"http://www.yamaha.co.jp/vocaloid/schema/vsq4/\";function m(e){var o=(new DOMParser).parseFromString(e,\"text/xml\");if(function(e){var t=(new DOMParser).parseFromString(\"<\",\"text/xml\").getElementsByTagName(\"parsererror\")[0].namespaceURI;if(\"http://www.w3.org/1999/xhtml\"===t)return e.getElementsByTagName(\"parsererror\").length>0;return e.getElementsByTagNameNS(t,\"parsererror\").length>0}(o))return{error:\"XML parse error\",data:null};if(o.children.length<=0||o.children[0].namespaceURI!==s&&o.children[0].namespaceURI!==l||\"vsq3\"!==o.children[0].tagName&&\"vsq4\"!==o.children[0].tagName)return{error:\"Unsupported VSQX format\",data:null};var i,m=o.children[0],p=m.querySelector(\"vsq3>vender\")||m.querySelector(\"vsq4>vender\"),v=p&&p.textContent,y=m.querySelector(\"vsq3>version\")||m.querySelector(\"vsq4>version\"),q=y&&y.textContent,S=\"vsq3\"===o.children[0].tagName,f=(S?[\"vsq3>masterTrack>resolution\",\"vsq3>masterTrack>preMeasure\",\"vsq3>masterTrack>timeSig>nume\",\"vsq3>masterTrack>timeSig>denomi\"]:[\"vsq4>masterTrack>resolution\",\"vsq4>masterTrack>preMeasure\",\"vsq4>masterTrack>timeSig>nu\",\"vsq4>masterTrack>timeSig>de\"]).map(function(e){return parseInt(m.querySelector(e).textContent)}),k=f[0],d=f[1],x=f[2],g=f[3],T=S?function(e){var t=Array.prototype.slice.call(e.querySelectorAll(\"vsq3>masterTrack>tempo\")).map(r);return t.forEach(function(e,r){r<t.length-1&&(e.duration=t[r+1].tick-e.tick)}),t}(m):function(e){var t=Array.prototype.slice.call(e.querySelectorAll(\"vsq4>masterTrack>tempo\")).map(c);return t.forEach(function(e,r){r<t.length-1&&(e.duration=t[r+1].tick-e.tick)}),t}(m),h=S?(i=m,Array.prototype.slice.call(i.querySelectorAll(\"vsq3>vVoiceTable>vVoice\")).map(t)):function(e){return Array.prototype.slice.call(e.querySelectorAll(\"vsq4>vVoiceTable>vVoice\")).map(a)}(m);return{data:{vender:v,version:q,resolution:k,preMeasure:d,timeSig:{nume:x,denomi:g},voices:h,tempos:T,tracks:S?n(m,h):u(m,h),raw:m}}}var p=function(){function e(e){this.result=e}return Object.defineProperty(e.prototype,\"data\",{get:function(){return this.result.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"ticksPerMeasure\",{get:function(){return 4*this.result.data.resolution/this.result.data.timeSig.denomi*this.result.data.timeSig.nume},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"offsetTick\",{get:function(){return this.result.data.preMeasure*this.ticksPerMeasure},enumerable:!0,configurable:!0}),e.prototype.getOffsetTickForTrack=function(e){return e.content.tick+this.offsetTick},e.prototype.tickToTime=function(e){for(var t=this.result.data,r=t.tempos,n=t.resolution,o=0,a=0,c=r;a<c.length;a++){var u=c[a],i=v(u,n);if(!(-1!==u.duration&&u.tick+u.duration<e)){o+=(e-u.tick)*i;break}o+=u.duration*i}return o},e}();function v(e,t){return 6e4/(e.bpm/100)/t}export{p as VSQXParseResultUtil,e as findVoice,m as parse,v as timePerTick};\n","import { parse, VSQXParseResultUtil } from \"../\";\r\n\r\nconst input = document.querySelector(\"input\") as HTMLInputElement;\r\ninput.addEventListener(\"change\", handleFileSelect);\r\n\r\nfunction handleFileSelect() {\r\n  if (input.files.length <= 0) return;\r\n  const file = input.files.item(0);\r\n  const reader = new FileReader();\r\n  reader.addEventListener(\"load\", _e => {\r\n    const result = parse(reader.result as string);\r\n\r\n    // print error\r\n    if (result.error) {\r\n      console.error(result.error);\r\n      return;\r\n    }\r\n\r\n    // store result util in a global variable\r\n    const util = new VSQXParseResultUtil(result);\r\n    self[\"util\"] = util;\r\n\r\n    // store raw DOM tree in a global variable\r\n    const raw = result.data.raw;\r\n    self[\"vsqx\"] = raw;\r\n    delete result.data.raw;\r\n\r\n    // print result\r\n    document.querySelector(\"pre\").textContent = JSON.stringify(\r\n      result,\r\n      null,\r\n      \"  \"\r\n    );\r\n\r\n    // print track info\r\n    const dl = document.querySelector(\"dl\");\r\n    result.data.tracks.forEach(track => {\r\n      const dt = document.createElement(\"dt\");\r\n      dt.appendChild(document.createTextNode(`${track.no}:${track.name}`));\r\n      const dd = document.createElement(\"dd\");\r\n      dd.appendChild(\r\n        document.createTextNode(\r\n          track.content.notes.map(note => note.lyric).join(\"\")\r\n        )\r\n      );\r\n      dl.appendChild(dt);\r\n      dl.appendChild(dd);\r\n    });\r\n  });\r\n  reader.readAsText(file);\r\n  // Array.from(input.files).forEach(console.log.bind(console));\r\n}\r\n"]}